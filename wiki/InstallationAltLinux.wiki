#summary How to install panel to Alt Linux server.
#labels Phase-Deploy

How-To was provided by [mailto:alyecseev@gmail.com Alex Negulescu].

= Instructions =

Because under
Alt we had only latest ruby (till recently), i have been using a
custom-built ruby in /opt. So, small how-to, basically for Alt, but it
should work on any distro (+/- some apt packages):

{{{
apt-get install autoconf_2.60 libreadline libreadline-devel openssl
zlib-devel libssl-devel libsqlite3-devel libsqlite3 sqlite3 gcc4.4
make
}}}

{{{
cd /tmp
wget http://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.7-p352.tar.bz2
tar -xjvf ruby-1.8.7-p352.tar.bz2
cd ruby-1.8.7*
autoconf
./configure --program-suffix=187 --enable-shared --prefix=/opt/ovzwp
make
make install
cd ext/openssl
/opt/ovzwp/bin/ruby187 extconf.rb
make
make install
cd ../zlib
/opt/ovzwp/bin/ruby187 extconf.rb
make
make install
}}}

Now gems:
{{{
cd ../../..
wget http://rubyforge.org/frs/download.php/74619/rubygems-1.7.2.tgz
tar -xzvf rubygems-1.7.2.tgz
cd rubygems-1.7.2
}}}

Alternatively you can use RVM to obtain Ruby 1.8. See https://rvm.beginrescueend.com/ for details.

{{{
/opt/ovzwp/bin/ruby187 setup.rb all
/opt/ovzwp/bin/gem187 install rubygems-update
/opt/ovzwp/bin/gem187 install rails --verbose
/opt/ovzwp/bin/gem187 install sqlite3-ruby --verbose
}}}

{{{
ln -s /var/lib/vz /vz
cd ..
wget http://ovz-web-panel.googlecode.com/files/ovz-web-panel-2.0.tgz
tar -xzvf ovz-web-panel-2.0.tgz -C /opt/ovzwp
mv /opt/ovzwp/ovz-web-panel /opt/ovzwp/distr
chmod 755 /opt/ovzwp/distr/script/owp

sed -i "s/ruby/\/opt\/ovzwp\/bin\/ruby187/g" /opt/ovzwp/distr/script/
owp
mv /opt/ovzwp/distr/config/owp.conf.sample /opt/ovzwp/distr/config/
owp.conf
sed -i "s/INSTALL_DIR=\/opt\/ovz-web-panel\//INSTALL_DIR=\/opt\/ovzwp\/
distr\//g" /opt/ovzwp/distr/config/owp.conf

mv /opt/ovzwp/distr/utils/hw-daemon/hw-daemon.ini.sample /opt/ovzwp/
distr/utils/hw-daemon/hw-daemon.ini

sed -i "s/key = secret/key = `head -c 200 \/dev\/urandom | md5sum |
cut -f1 -d" "`/g" /opt/ovzwp/distr/utils/hw-daemon/hw-daemon.ini &&
cat /opt/ovzwp/distr/utils/hw-daemon/hw-daemon.ini | grep key
}}}

Now we have the key, and also it is setup in the config.

Edit rc.local to add:
{{{
/opt/ovzwp/distr/script/owp start
}}}

Then just start the toy, login and add your host(s) and key(s)!