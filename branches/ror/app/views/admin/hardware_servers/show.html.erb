<% @page_title = t('admin.hardware_servers.show.title', :name => @hardware_server.host) %>

<% javascript_tag do -%>
Ext.onReady(function() {

  var store = new Ext.data.JsonStore({
    url: '/admin/virtual-servers/list_data?hardware_server_id=<%= @hardware_server.id %>',
    root: 'data',
    autoLoad: true,
    fields: [
      { name: 'id' },
      { name: 'identity' },
      { name: 'ip_address' },
      { name: 'host_name' },
      { name: 'state' },
      { name: 'os_template_name' }
    ]
  });
  
  var selectionModel = new Ext.grid.CheckboxSelectionModel({ 
    listeners: {
      selectionchange: function(selectionModel) {
        if (selectionModel.getCount()) {
          virtualServersGrid.removeButton.enable();
        } else {
          virtualServersGrid.removeButton.disable();
        }
      }
    }
  });
  
  var virtualServersGrid = new Ext.grid.GridPanel({
    id: 'virtualServersGrid',
    title: '<%= tjs('admin.virtual_servers.grid.title') %>',
    iconCls: 'icon-items-list',
    store: store,
    cm: new Ext.grid.ColumnModel([
      selectionModel, 
      { 
        id: 'state',
        header: '<%= tjs('admin.virtual_servers.grid.column.state') %>',
        renderer: function(value) {
          var image = ('running' == value) ? 'control_play_blue.png' : 'control_stop_blue.png';
          return '<img src="/images/' + image + '"/>';
        },
        width: 60,
        align: 'center',
        sortable: true,
        dataIndex: 'state'
      }, { 
        id: 'identity',
        header: '<%= tjs('admin.virtual_servers.grid.column.identity') %>',
        sortable: true,
        dataIndex: 'identity'
      }, {
        id: 'ip_address',
        header: '<%= tjs('admin.virtual_servers.grid.column.ip_address') %>',
        sortable: true,
        dataIndex: 'ip_address'
      }, {
        id: 'host_name',
        header: '<%= tjs('admin.virtual_servers.grid.column.host_name') %>',
        sortable: true,
        dataIndex: 'host_name'
      }, {
        id: 'os_template_name',
        header: '<%= tjs('admin.virtual_servers.grid.column.os_template') %>',
        sortable: true,
        dataIndex: 'os_template_name' 
      }
    ]),
    sm: selectionModel,
    stripeRows: true,
    autoExpandColumn: 'os_template_name',
    autoHeight: true,
    autoWidth: true,
    stripeRows: true,
    frame: true,
    tbar: [{
      text: '<%= tjs('admin.virtual_servers.grid.button.create') %>',
      cls: 'x-btn-text-icon',
      icon: '/images/add.png',
      handler: function() {
      }
    }, {
      text: '<%= tjs('admin.virtual_servers.grid.button.destroy') %>', 
      cls: 'x-btn-text-icon',
      icon: '/images/delete.png',     
      handler: function() {
      },
      ref: '../removeButton',
      disabled: true
    }]
  });
  
  virtualServersGrid.render('virtaul-servers-list');  
});
<% end -%>

<div id="virtaul-servers-list"></div>

