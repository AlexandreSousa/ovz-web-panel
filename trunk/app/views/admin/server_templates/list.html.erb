<% @page_title = t('admin.server_templates.title', { :name => @hardware_server.host }) %>

<% javascript_tag do -%>
Ext.onReady(function() {

  function addTemplate() {
    
  }
  
  function removeTemplate() {
    Ext.MessageBox.confirm(
      '<%= tjs('form.confirmation') %>',
      '<%= tjs('admin.server_templates.form.remove_template.sure_to_remove') %>',
      function(button, text) {
        if ('yes' == button) { 
          Owp.list.groupAction({
            gridName: 'serverTemplatesGrid',
            url: '/admin/server-templates/delete',
            waitMsg: '<%= tjs('form.performing_task') %>',
            failure: {
              title: '<%= tjs('form.error.title') %>',
              msg: '<%= tjs('admin.server_templates.form.remove_template.deletion_failed') %>'
            }
          });
        }
      }
    );
  }
  
  function editTemplate() {
    
  }

  var store = new Ext.data.JsonStore({
    url: '/admin/server-templates/list_data?hardware_server_id=' + <%= @hardware_server.id %>,
    root: 'data',
    autoLoad: true,
    sortInfo: { field: 'name', direction: 'ASC' },
    fields: [
      { name: 'id' },
      { name: 'name' },
      { name: 'is_default' }
    ]
  });
  
  var selectionModel = new Ext.grid.CheckboxSelectionModel({
    listeners: {
      selectionchange: function(selectionModel) {
        if (selectionModel.getCount()) {
          serverTemplatesGrid.removeButton.enable();
        } else {
          serverTemplatesGrid.removeButton.disable();
        }
        
        if (1 == selectionModel.getCount()) {
          serverTemplatesGrid.editButton.enable();
        } else {
          serverTemplatesGrid.editButton.disable();
        }
      }
    }
  });
  
  var serverTemplatesGrid = new Ext.grid.GridPanel({
    id: 'serverTemplatesGrid',
    store: store,
    title: '<%= tjs('admin.server_templates.grid.title') %>',
    loadMask: true,
    tools: [{ 
      id: 'refresh',
      handler: function() {
        serverTemplatesGrid.getStore().reload();
      }
    }],
    cm: new Ext.grid.ColumnModel([
      selectionModel, 
      {
        id: 'name',
        header: '<%= tjs('admin.server_templates.grid.column.name') %>',
        sortable: true,
        dataIndex: 'name',
        renderer: function(name, metadata, record) {
          if (record.data.is_default) {
            return '<b>' + name + '</b> (<%= tjs('admin.server_templates.grid.column.template_default') %>)';
          } else {
            return name;
          }
        }
      }
    ]),
    sm: selectionModel,
    stripeRows: true,
    autoExpandColumn: 'name',
    autoWidth: true,
    stripeRows: true,
    frame: true,
    iconCls: 'icon-items-list',
    tbar: [/*{
      text: '<%= tjs('admin.server_templates.grid.button.add') %>',
      handler: addTemplate,
      cls: 'x-btn-text-icon',
      icon: '/images/add.png'
    }, */{
      text: '<%= tjs('admin.server_templates.grid.button.remove') %>',
      handler: removeTemplate,
      cls: 'x-btn-text-icon',
      icon: '/images/delete.png',
      ref: '../removeButton',
      disabled: true
    }/*, {
      text: '<%= tjs('admin.server_templates.grid.button.edit') %>',
      handler: editTemplate,
      cls: 'x-btn-text-icon',
      icon: '/images/wrench.png',
      ref: '../editButton',
      disabled: true
    }*/]
  });

  Owp.layout.addToCenter(serverTemplatesGrid);

});
<% end -%>